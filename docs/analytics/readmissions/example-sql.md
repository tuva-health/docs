---
id: example-sql
title: "Example SQL"
---

<details><summary>How do I calculate basic readmission statistics for my patient population?</summary>

```sql
-- Simple readmission statistics
select 
    1 as id
,   'Index Admissions' as measure
,   count(1) as value
from readmissions.readmission_summary
where index_admission_flag = 1

union

select 
    2 as id
,   'Unplanned 30-day Readmissions' as measure
,   count(1) as value
from readmissions.readmission_summary
where index_admission_flag = 1 
    and unplanned_readmit_30_flag = 1
    
union

select 
    3 as id
,   'Avg Days to Readmission' as measure
,   avg(days_to_readmit) as value
from readmissions.readmission_summary
where index_admission_flag = 1 
    and unplanned_readmit_30_flag = 1

union

select 
    4 as id
,   'Readmission Avg Length of Stay' as measure
,   avg(readmission_length_of_stay) as value
from readmissions.readmission_summary
where index_admission_flag = 1 
    and unplanned_readmit_30_flag = 1
    
union

select 
    5 as id
,   'Readmission Mortalities' as measure
,   sum(died_flag) as value
from readmissions.readmission_summary
where index_admission_flag = 1 
    and unplanned_readmit_30_flag = 1
    
union

select 
    6 as id
,   'Readmission Avg Paid Amount' as measure
,   cast(avg(paid_amount) as numeric(38,0)) as value
from readmissions.readmission_summary
where index_admission_flag = 1 
    and unplanned_readmit_30_flag = 1
order by 1
```

The following output is obtained by running the above query on the Tuva Claims Demo dataset.

![The Tuva Project](/img/readmissions/basic_stats.jpg)
</details>


<details><summary>How do I trend the hospital-wide readmission rate?</summary>

```sql
-- readmission rate by month
with index_admissions as (
select
    date_part(year, discharge_date) || '-' || lpad(date_part(month, discharge_date),2,0) as year_month
,   count(1) as index_admissions
from readmissions.readmission_summary
where index_admission_flag = 1
group by 1
)

, readmissions as (
select 
    date_part(year, discharge_date) || '-' || lpad(date_part(month, discharge_date),2,0) as year_month
,   count(1) as readmissions
from readmissions.readmission_summary
where index_admission_flag = 1 
    and unplanned_readmit_30_flag = 1
group by 1
)

select
    a.year_month
,   a.index_admissions
,   coalesce(b.readmissions,0) as readmissions
,   cast(coalesce(b.readmissions,0) / a.index_admissions as numeric(38,2)) as readmission_rate
from index_admissions a
left join readmissions b
    on a.year_month = b.year_month
order by 1
```
The following output is generated by running the above query on the Tuva Claims Demo dataset.  The results are sparse for this dataset (there are only 5 total readmissions) but you can get a sense of the structure of the table and how you might use it against your data.

![The Tuva Project](/img/readmissions/readmission_rate_monthly.jpg)

</details>

<details><summary>What data quality issues can impact readmission analytics?</summary>
There are several types of data quality issues that can prevent a hospitalization from qualifying as an index admission or from being part of a readmission measure.  Data quality checks for these issues are built into the Tuva Project's readmission mart.  The query below reports the total number of inpatient encounters and the number of encounters that fail any particular data quality check.

```sql
-- readmission data quality issues
with dq_stats as (
select 
    cast(count(1) as int) as total_encounters
,   cast(sum(disqualified_encounter_flag) as int) as disqualified_encounters
,   cast(sum(missing_admit_date_flag) as int) as missing_admit_date
,   cast(sum(missing_discharge_date_flag) as int) as missing_discharge_date
,   cast(sum(admit_after_discharge_flag) as int) as admit_after_discharge_date
,   cast(sum(missing_discharge_disposition_code_flag) as int) as missing_discharge_disposition
,   cast(sum(invalid_discharge_disposition_code_flag) as int) as invalid_discharge_disposition
,   cast(sum(missing_primary_diagnosis_flag) as int) as missing_primary_diagnosis
,   cast(sum(multiple_primary_diagnoses_flag) as int) as multiple_primary_diagnoses
,   cast(sum(invalid_primary_diagnosis_code_flag) as int) as invalid_primary_diagnosis
,   cast(sum(no_diagnosis_ccs_flag) as int) as no_diagnosis_ccs
,   cast(sum(overlaps_with_another_encounter_flag) as int) as overlapping_encounter
,   cast(sum(missing_ms_drg_flag) as int) as missing_ms_drg
,   cast(sum(invalid_ms_drg_flag) as int) as invalid_ms_drg
from readmissions.encounter_augmented
)
select 
    measure
,   number_of_encounters
from dq_stats
unpivot(number_of_encounters for measure in (total_encounters,
                                     disqualified_encounters,
                                     missing_admit_date,
                                     missing_discharge_date,
                                     admit_after_discharge_date,
                                     missing_discharge_disposition,
                                     invalid_discharge_disposition,
                                     missing_primary_diagnosis,
                                     multiple_primary_diagnoses,
                                     invalid_primary_diagnosis,
                                     no_diagnosis_ccs,
                                     overlapping_encounter,
                                     missing_ms_drg,
                                     invalid_ms_drg                                     
                                    ))

```

The following is example output from this query from the Tuva Claims Demo dataset.  You can see there are a total of 223 inpatient encounters in the dataset, 79 of which are excluded from readmission analytics due to data quality issues.  You can then see the specific reasons for the exclusion (i.e. missing primary diagnosis and overlapping encounter).

![The Tuva Project](/img/readmissions/data_quality_issues.jpg)
</details>